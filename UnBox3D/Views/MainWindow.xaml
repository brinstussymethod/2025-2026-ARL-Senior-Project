<Window x:Class="UnBox3D.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:viewmodels="clr-namespace:UnBox3D.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        Title="UnBox3D"
        Height="600"
        Width="800"
        WindowStartupLocation="CenterScreen"
        Icon="pack://application:,,,/Assets/Icons/logo.ico">


    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="File">
                <MenuItem Header="Import OBJ..." Click="ImportModel_Click"/>
                <MenuItem Header="Export Scene as OBJ..." Click="ExportModel_Click"/>
                <Separator/>
                <MenuItem Header="Exit" Click="Exit_Click"/>
            </MenuItem>

            <!-- View Menu -->
            <MenuItem Header="View">
                <MenuItem Header="Reset View" Command="{Binding ResetViewCommand}"/>
                <MenuItem Header="Toggle Hierarchy" Command="{Binding ToggleHierarchyCommand}"/>
            </MenuItem>

            <!-- Tools Menu -->
            <MenuItem Header="Tools">
                <MenuItem Header="Replace Scene with Bounding Boxes" Command="{Binding ReplaceSceneWithBoundingBoxesCommand}"/>
                <Separator/>
                <MenuItem Header="Simplify All (QEC)" Command="{Binding SimplifyAllQECCommand}"/>
                <MenuItem Header="Simplify All (FQD)" Command="{Binding SimplifyAllFQDCommand}"/>
                <MenuItem Header="Simplify All (VC)" Command="{Binding SimplifyAllVCCommand}"/>
            </MenuItem>

            <!-- Settings Menu -->
            <MenuItem Header="Settings" Click="Settings_Click"/>

            <!-- Help Menu -->
            <MenuItem Header="Help">
                <MenuItem Header="About" Command="{Binding AboutCommand}"/>
            </MenuItem>
        </Menu>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" />  <!-- TreeView Column -->
                <ColumnDefinition Width="5"/>     <!-- Splitter -->
                <ColumnDefinition Width="*" />    <!-- OpenGL Host Column -->
                <ColumnDefinition Width="300" />  <!-- Right Panel Column -->
            </Grid.ColumnDefinitions>

            <!-- Left Panel: TreeView (Hierarchical Mesh View) -->
            <!-- Replaced StackPanel with Grid to enable scrolling -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <!-- Header -->
                    <RowDefinition Height="Auto"/>
                    <!-- TreeView fills remaining space -->
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Meshes"
               FontSize="16"
               FontWeight="SemiBold"
               Margin="10,10,0,5"
               Grid.Row="0"/>

                <TreeView x:Name="MeshesTreeView"
              Grid.Row="1"
              Padding="10"
              ItemsSource="{Binding Meshes}"
              SelectedItemChanged="TreeView_SelectedItemChanged"
              VirtualizingStackPanel.IsVirtualizing="True"
              VirtualizingStackPanel.VirtualizationMode="Recycling"
              ScrollViewer.CanContentScroll="True">

                    <TreeView.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock>
                        <Run Text="{Binding Name}" FontWeight="Bold"/>
                        <Run Text=" (" Foreground="Gray"/>
                        <Run Text="{Binding VertexCount}" Foreground="Gray"/>
                        <Run Text=" vertices)" Foreground="Gray"/>
                                </TextBlock>

                                <Button Content="Export"
                            Margin="10,0,0,0"
                            Command="{Binding DataContext.ExportMeshCommand, RelativeSource={RelativeSource AncestorType=TreeView}}"
                            CommandParameter="{Binding SourceMesh}"/>

                                <Button Content="Delete"
                            Margin="5,0,0,0"
                            Command="{Binding DataContext.DeleteMeshCommand, RelativeSource={RelativeSource AncestorType=TreeView}}"
                            CommandParameter="{Binding SourceMesh}"/>
                            </StackPanel>
                        </DataTemplate>
                    </TreeView.ItemTemplate>

                </TreeView>
            </Grid>

            <!-- Splitter between TreeView and OpenGL rendering host -->
            <GridSplitter Grid.Column="1"
                          Width="5"
                          HorizontalAlignment="Stretch"
                          Background="Gray"
                          ShowsPreview="True"/>

            <!-- Right Panel: Controls (Mesh Threshold, Dimensions, Export Buttons) -->
            <StackPanel Grid.Column="3" Orientation="Vertical" Margin="10">
                <!-- Small Mesh Threshold -->
                <TextBlock Text="Small Mesh Threshold" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <Slider x:Name="MeshThreshold" Minimum="0" Maximum="100" Value="{Binding SmallMeshThreshold, Mode=TwoWay}"
                        ValueChanged="MeshThreshold_ValueChanged"/>

                <!-- Page Size for Unfolding -->
                <TextBlock Text="Page Size (for Unfold)" FontWeight="SemiBold" Margin="0,10,0,4"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                    <TextBlock Text="W:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBox Name="PageWidthTextBox"
                             Width="80"
                             Text="{Binding PageWidth, UpdateSourceTrigger=PropertyChanged}"
                             PreviewTextInput="NumericTextBox_PreviewTextInput"
                             PreviewKeyDown="NumericTextBox_PreviewKeyDown"
                             TextChanged="NumericTextBox_TextChanged"
                             LostFocus="NumericTextBox_LostFocus"/>
                    <TextBlock Text="  H:" VerticalAlignment="Center" Margin="10,0,6,0"/>
                    <TextBox Name="PageHeightTextBox"
                             Width="80"
                             Text="{Binding PageHeight, UpdateSourceTrigger=PropertyChanged}"
                             PreviewTextInput="NumericTextBox_PreviewTextInput"
                             PreviewKeyDown="NumericTextBox_PreviewKeyDown"
                             TextChanged="NumericTextBox_TextChanged"
                             LostFocus="NumericTextBox_LostFocus"/>
                </StackPanel>

                <!-- Export Unfolded Options -->
                <Button Content="Export Unfolded (SVG/PDF)..." Command="{Binding ExportUnfoldModelCommand}" Margin="0,0,0,10"/>

                <!-- Replacement Tools -->
                <TextBlock Text="Replacement Tools" FontWeight="SemiBold" Margin="0,10,0,4"/>
                <StackPanel Orientation="Horizontal">
                    <Button Content="To Cylinder"
                            Margin="0,0,8,0"
                            Command="{Binding ReplaceWithCylinderClickCommand}"
                            CommandParameter="{Binding ElementName=MeshesTreeView, Path=SelectedItem.SourceMesh}" />

                    <Button Content="To Cube"
                            Margin="0,0,8,0"
                            Command="{Binding ReplaceWithCubeClickCommand}"
                            CommandParameter="{Binding ElementName=MeshesTreeView, Path=SelectedItem.SourceMesh}" />
                    <Button Content="To Wedge"
                            Command="{Binding ReplaceWithWedgeClickCommand}"
                            CommandParameter="{Binding ElementName=MeshesTreeView, Path=SelectedItem.SourceMesh}" />
                </StackPanel>

                <!-- Scene Tools -->
                <TextBlock Text="Scene Tools" FontWeight="SemiBold" Margin="0,10,0,4"/>
                <StackPanel Orientation="Horizontal">
                    <Button Content="Clear Scene" Command="{Binding ClearSceneCommand}" />
                </StackPanel>

                <!-- Import/Export -->
                <TextBlock Text="Import/Export" FontWeight="SemiBold" Margin="0,10,0,4"/>
                <StackPanel Orientation="Horizontal">
                    <Button Content="Import OBJ..." Click="ImportModel_Click" />
                    <Button Content="Export Scene as OBJ..." Click="ExportModel_Click" Margin="10,0,0,0"/>
                </StackPanel>

                <!-- Exit and Settings -->
                <TextBlock Text="Application" FontWeight="SemiBold" Margin="0,10,0,4"/>
                <StackPanel Orientation="Horizontal">
                    <Button Content="Settings" Click="Settings_Click" />
                    <Button Content="Exit" Click="Exit_Click" Margin="10,0,0,0"/>
                </StackPanel>
            </StackPanel>

            <!-- Splitter  -->
            <GridSplitter Grid.Column="1"
                          Width="5"
                          HorizontalAlignment="Stretch"
                          Background="Gray"
                          ShowsPreview="True"/>

            <!-- OpenGL Rendering Host -->
            <WindowsFormsHost Grid.Column="2" Name="openGLHost" />
        </Grid>
    </DockPanel>
</Window>
